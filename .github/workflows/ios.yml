name: iOS CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: macos-latest
    
    strategy:
      matrix:
        scheme: ["Development", "Production"]
        
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set Xcode version
      run: sudo xcode-select -s '/Applications/Xcode_13.1.app' 
      # Ensure to use a version that has your required simulators and SDKs

    - name: List available simulators
      run: xcrun simctl list devices available
    
    - name: Build and Test
      env:
        SCHEME: ${{ matrix.scheme }}
      run: |
        xcodebuild build-for-testing -scheme "$SCHEME" -destination "platform=iOS Simulator,OS=15.0,name=iPhone 11" -workspace "YourWorkspace.xcworkspace"
        xcodebuild test-without-building -scheme "$SCHEME" -destination "platform=iOS Simulator,OS=15.0,name=iPhone 11" -workspace "YourWorkspace.xcworkspace"
